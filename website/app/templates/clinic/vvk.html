<!DOCTYPE html>
<html>
<head>
    <title>VVK Records</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { width: 80%; margin: 0 auto; }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid black; }
        th, td { padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close:hover, .close:focus { color: black; text-decoration: none; cursor: pointer; }
        .button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h1>VVK Records</h1>
        <button class="button" id="openModalBtn">Create New VVK Record</button>
        <table id="vvkTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Patient ID</th>
                    <th>Content</th>
                    <th>Number</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be added here dynamically -->
            </tbody>
        </table>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Create New VVK Record</h2>
            <form id="vvkForm">
                <label for="patient_id">Patient ID:</label><br>
                <input type="number" id="patient_id" name="patient_id" required><br>
                <label for="content">Content:</label><br>
                <textarea id="content" name="content" required></textarea><br>
                <label for="number">Number:</label><br>
                <input type="text" id="number" name="number" required><br>
                <label for="date">Date:</label><br>
                <input type="date" id="date" name="date" required><br><br>
                <button type="submit" class="button">Create</button>
            </form>
        </div>
    </div>

    <script>
        // Modal functionality
        var modal = document.getElementById("myModal");
        var btn = document.getElementById("openModalBtn");
        var span = document.getElementsByClassName("close")[0];

        btn.onclick = function() {
            modal.style.display = "block";
        }

        span.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Load VVK records
        function loadVVKRecords() {
            fetch('/vvk/')
                .then(response => response.json())
                .then(data => {
                    const vvkTable = document.getElementById('vvkTable').querySelector('tbody');
                    vvkTable.innerHTML = '';
                    data.forEach(record => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${record.id}</td><td>${record.patient_id}</td><td>${record.content}</td><td>${record.number}</td><td>${record.date}</td>`;
                        vvkTable.appendChild(row);
                    });
                });
        }

        // Handle form submission
        document.getElementById('vvkForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            fetch('/vvk/', {
                method: 'POST',
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                modal.style.display = "none";
                loadVVKRecords();
            })
            .catch(error => console.error('Error:', error));
        });

        // Load VVK records on page load
        document.addEventListener('DOMContentLoaded', loadVVKRecords);
    </script>
</body>
</html>
